From 78ce3a47aa8d59ad491e219cd4b9879743ff3972 Mon Sep 17 00:00:00 2001
From: xinhui pan <xinhui.pan@amd.com>
Date: Thu, 25 Oct 2018 14:35:13 +0800
Subject: [PATCH 2108/2940] drm/amdgpu: add module parameters for ras

Allow RAS feature enable/disable via boot parameter.

Change-Id: I568ec3c6622b7a588dbd8883a6c15f7c23df236e
Signed-off-by: xinhui pan <xinhui.pan@amd.com>
Reviewed-by: Hawking Zhang <Hawking.Zhang@amd.com>
Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c     | 10 ++++-----
 drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c.rej | 25 +++++++++++++++++++++
 2 files changed, 30 insertions(+), 5 deletions(-)
 create mode 100644 drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c.rej

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
index 65cd16b03772..7e34e9701d9e 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
@@ -516,19 +516,19 @@ module_param_named(gpu_recovery, amdgpu_gpu_recovery, int, 0444);
 MODULE_PARM_DESC(emu_mode, "Emulation mode, (1 = enable, 0 = disable)");
 module_param_named(emu_mode, amdgpu_emu_mode, int, 0444);
 
-/**
- * DOC: ras_enable (int)
+/*
+ * DOC: amdgpu_ras_enable (int)
  * Enable RAS features on the GPU (0 = disable, 1 = enable, -1 = auto (default))
  */
-MODULE_PARM_DESC(ras_enable, "Enable RAS features on the GPU (0 = disable, 1 = enable, -1 = auto (default))");
+MODULE_PARM_DESC(amdgpu_ras_enable, "Enable RAS features on the GPU (0 = disable, 1 = enable, -1 = auto (default))");
 module_param_named(ras_enable, amdgpu_ras_enable, int, 0444);
 
 /**
- * DOC: ras_mask (uint)
+ * DOC: amdgpu_ras_mask (uint)
  * Mask of RAS features to enable (default 0xffffffff), only valid when ras_enable == 1
  * See the flags in drivers/gpu/drm/amd/amdgpu/amdgpu_ras.h
  */
-MODULE_PARM_DESC(ras_mask, "Mask of RAS features to enable (default 0xffffffff), only valid when ras_enable == 1");
+MODULE_PARM_DESC(amdgpu_ras_mask, "Mask of RAS features to enable (default 0xffffffff), only valid when ras_enable == 1");
 module_param_named(ras_mask, amdgpu_ras_mask, uint, 0444);
 
 /**
diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c.rej b/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c.rej
new file mode 100644
index 000000000000..45e382c74eee
--- /dev/null
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c.rej
@@ -0,0 +1,25 @@
+--- drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
++++ drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
+@@ -511,6 +513,22 @@ module_param_named(gpu_recovery, amdgpu_gpu_recovery, int, 0444);
+ MODULE_PARM_DESC(emu_mode, "Emulation mode, (1 = enable, 0 = disable)");
+ module_param_named(emu_mode, amdgpu_emu_mode, int, 0444);
+ 
++/*
++ * DOC: amdgpu_ras_enable (int)
++ * Enable RAS features on the GPU (0 = disable, 1 = enable, -1 = auto (default))
++ */
++MODULE_PARM_DESC(amdgpu_ras_enable, "Enable RAS features on the GPU (0 = disable, 1 = enable, -1 = auto (default))");
++module_param_named(ras_enable, amdgpu_ras_enable, int, 0444);
++
++/**
++ * DOC: amdgpu_ras_mask (uint)
++ * Mask of RAS features to enable (default 0xffffffff), only valid when ras_enable == 1
++ * See the flags in drivers/gpu/drm/amd/amdgpu/amdgpu_ras.h
++ */
++MODULE_PARM_DESC(amdgpu_ras_mask, "Mask of RAS features to enable (default 0xffffffff), only valid when ras_enable == 1");
++module_param_named(ras_mask, amdgpu_ras_mask, uint, 0444);
++
++
+ /**
+  * DOC: si_support (int)
+  * Set SI support driver. This parameter works after set config CONFIG_DRM_AMDGPU_SI. For SI asic, when radeon driver is enabled,
-- 
2.17.1

