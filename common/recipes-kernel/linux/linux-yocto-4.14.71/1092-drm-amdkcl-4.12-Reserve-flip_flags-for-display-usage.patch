From dac5fde49dd1d8e4c5064faf3e2c0f798b5ffcf7 Mon Sep 17 00:00:00 2001
From: "Le.Ma" <Le.Ma@amd.com>
Date: Tue, 26 Sep 2017 11:13:00 +0800
Subject: [PATCH 1092/4131] drm/amdkcl: [4.12] Reserve flip_flags for display
 usage

Change-Id: I9205bb7f5f5df8b1483648044cb305348e0a91b3
Signed-off-by: Le.Ma <Le.Ma@amd.com>
---
 drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index 517a4c4..a582fa2 100644
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@ -4167,6 +4167,11 @@ static void amdgpu_dm_commit_planes(struct drm_atomic_state *state,
 				crtc,
 				fb,
 				drm_crtc_vblank_count(crtc) + *wait_for_vblank);
+
+                        /*TODO BUG remove ASAP in 4.12 to avoid race between worker and flip IOCTL */
+
+                        /*clean up the flags for next usage*/
+                        acrtc_attach->flip_flags = 0;
 		}
 
 	}
-- 
2.7.4

