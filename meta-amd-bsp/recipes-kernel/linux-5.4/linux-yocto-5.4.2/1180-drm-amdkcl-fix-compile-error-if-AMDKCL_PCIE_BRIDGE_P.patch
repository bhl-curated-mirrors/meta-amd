From 76a880931bae9bd29b052942833d9369a8491686 Mon Sep 17 00:00:00 2001
From: "Stanley.Yang" <Stanley.Yang@amd.com>
Date: Wed, 25 Dec 2019 15:58:05 +0800
Subject: [PATCH 1180/1453] drm/amdkcl: fix compile error if
 AMDKCL_PCIE_BRIDGE_PM_USABLE not defined

Change-Id: Ifb0ca16c311694338c6fb22f0d67c9382624a176
Signed-off-by: Stanley.Yang <Stanley.Yang@amd.com>
Reviewed-by: Flora Cui <flora.cui@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_atpx_handler.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_atpx_handler.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_atpx_handler.c
index 1f8303fbef4c..559e4e115918 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_atpx_handler.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_atpx_handler.c
@@ -628,8 +628,10 @@ static bool amdgpu_atpx_detect(void)
 
 		has_atpx |= (amdgpu_atpx_pci_probe_handle(pdev) == true);
 
+#ifdef AMDKCL_PCIE_BRIDGE_PM_USABLE
 		parent_pdev = pci_upstream_bridge(pdev);
 		d3_supported |= parent_pdev && parent_pdev->bridge_d3;
+#endif
 		amdgpu_atpx_get_quirks(pdev);
 	}
 
-- 
2.17.1

