From 0380657445260fe8f45c3312df7701186b22fdb8 Mon Sep 17 00:00:00 2001
From: "Le.Ma" <Le.Ma@amd.com>
Date: Fri, 11 Aug 2017 12:27:35 +0800
Subject: [PATCH 1746/4131] drm/amdkfd: Fix preferred_domains typo for kfd part

Change-Id: I0a53c6a929ddfb91954bb4fc215587b54cc96ebe
Signed-off-by: Le.Ma <Le.Ma@amd.com>
Reviewed-by: Evan Quan <evan.quan@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd.c       |  4 ++--
 drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c | 12 ++++++------
 2 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd.c
index 6d81727..a5d494a 100755
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd.c
@@ -446,7 +446,7 @@ int amdgpu_amdkfd_get_dmabuf_info(struct kgd_dev *kgd, int dma_buf_fd,
 
         adev = obj->dev->dev_private;
         bo = gem_to_amdgpu_bo(obj);
-	if (!(bo->prefered_domains & (AMDGPU_GEM_DOMAIN_VRAM |
+	if (!(bo->preferred_domains & (AMDGPU_GEM_DOMAIN_VRAM |
                                     AMDGPU_GEM_DOMAIN_GTT |
                                     AMDGPU_GEM_DOMAIN_DGMA)))
                 /* Only VRAM, GTT and DGMA BOs are supported */
@@ -466,7 +466,7 @@ int amdgpu_amdkfd_get_dmabuf_info(struct kgd_dev *kgd, int dma_buf_fd,
                 /* If the preferred domain is DGMA, set flags to VRAM because
                  * KFD doesn't support allocating DGMA memory
                  */
-                *flags = (bo->prefered_domains & (AMDGPU_GEM_DOMAIN_VRAM |
+		*flags = (bo->preferred_domains & (AMDGPU_GEM_DOMAIN_VRAM |
                                 AMDGPU_GEM_DOMAIN_DGMA)) ?
                                 ALLOC_MEM_FLAGS_VRAM : ALLOC_MEM_FLAGS_GTT;
 
diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c
index 505d006..bf01ad4 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c
@@ -184,7 +184,7 @@ void amdgpu_amdkfd_unreserve_system_memory_limit(struct amdgpu_bo *bo)
 	if (bo->flags & AMDGPU_AMDKFD_USERPTR_BO) {
 		kfd_mem_limit.system_mem_used -= bo->tbo.acc_size;
 		kfd_mem_limit.userptr_mem_used -= amdgpu_bo_size(bo);
-	} else if (bo->prefered_domains == AMDGPU_GEM_DOMAIN_GTT) {
+	} else if (bo->preferred_domains == AMDGPU_GEM_DOMAIN_GTT) {
 		kfd_mem_limit.system_mem_used -=
 			(bo->tbo.acc_size + amdgpu_bo_size(bo));
 	}
@@ -1723,7 +1723,7 @@ static int get_sg_table(struct amdgpu_device *adev,
 		goto out;
 	}
 
-	if (bo->prefered_domains == AMDGPU_GEM_DOMAIN_VRAM)
+	if (bo->preferred_domains == AMDGPU_GEM_DOMAIN_VRAM)
 		page_size = AMD_GPU_PAGE_SIZE;
 	else
 		page_size = PAGE_SIZE;
@@ -1737,7 +1737,7 @@ static int get_sg_table(struct amdgpu_device *adev,
 	if (unlikely(ret))
 		goto out;
 
-	if (bo->prefered_domains == AMDGPU_GEM_DOMAIN_VRAM) {
+	if (bo->preferred_domains == AMDGPU_GEM_DOMAIN_VRAM) {
 		bus_addr = bo->tbo.offset + adev->mc.aper_base + offset;
 
 		for_each_sg(sg->sgl, s, sg->orig_nents, i) {
@@ -1835,7 +1835,7 @@ int amdgpu_amdkfd_gpuvm_import_dmabuf(struct kgd_dev *kgd,
 		return -EINVAL;
 
 	bo = gem_to_amdgpu_bo(obj);
-	if (!(bo->prefered_domains & (AMDGPU_GEM_DOMAIN_VRAM |
+	if (!(bo->preferred_domains & (AMDGPU_GEM_DOMAIN_VRAM |
 				    AMDGPU_GEM_DOMAIN_GTT |
 				    AMDGPU_GEM_DOMAIN_DGMA)))
 		/* Only VRAM and GTT BOs are supported */
@@ -1859,9 +1859,9 @@ int amdgpu_amdkfd_gpuvm_import_dmabuf(struct kgd_dev *kgd,
 
 	(*mem)->bo = amdgpu_bo_ref(bo);
 	(*mem)->va = va;
-	if (bo->prefered_domains & AMDGPU_GEM_DOMAIN_VRAM)
+	if (bo->preferred_domains & AMDGPU_GEM_DOMAIN_VRAM)
 		(*mem)->domain = AMDGPU_GEM_DOMAIN_VRAM;
-	else if (bo->prefered_domains & AMDGPU_GEM_DOMAIN_GTT)
+	else if (bo->preferred_domains & AMDGPU_GEM_DOMAIN_GTT)
 		(*mem)->domain = AMDGPU_GEM_DOMAIN_GTT;
 	else
 		(*mem)->domain = AMDGPU_GEM_DOMAIN_DGMA;
-- 
2.7.4

