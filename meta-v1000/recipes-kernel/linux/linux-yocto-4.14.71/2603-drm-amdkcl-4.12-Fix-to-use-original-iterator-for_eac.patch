From 28436e2cff4d8285f19fb8bf79c45a5c4791b627 Mon Sep 17 00:00:00 2001
From: "Le.Ma" <Le.Ma@amd.com>
Date: Wed, 25 Oct 2017 15:16:19 +0800
Subject: [PATCH 2603/4131] drm/amdkcl: [4.12] Fix to use original iterator
 for_each_crtc_in_state()

Change-Id: Iaab4537c3eba5442a53b7f489b0df31382cccaf7
Signed-off-by: Le.Ma <Le.Ma@amd.com>
Reviewed-by: Xiaojie Yuan <Xiaojie.Yuan@amd.com>
---
 drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index 4501321..d1e3f1d 100644
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@ -4924,7 +4924,12 @@ static int amdgpu_dm_atomic_check(struct drm_device *dev,
 			}
 		}
 	} else {
+#if LINUX_VERSION_CODE < KERNEL_VERSION(4, 12, 0)
+		for_each_crtc_in_state(state, crtc, crtc_state, i) {
+			old_crtc_state = crtc->state;
+#else
 		for_each_oldnew_crtc_in_state(state, crtc, old_crtc_state, crtc_state, i) {
+#endif
 			if (!crtc_state->enable)
 				continue;
 
-- 
2.7.4

