From 8a73f14a39a47eeb6a8f4490b949227f322d591a Mon Sep 17 00:00:00 2001
From: Andrey Grodzovsky <Andrey.Grodzovsky@amd.com>
Date: Tue, 25 Jul 2017 18:07:24 -0400
Subject: [PATCH 0574/4131] drm/amd/display: Remove unblanaced drm_vblank_put.

Since drm_vblank_get moved from this function to just
before do_flip no need to release vblank here in case of error.

Signed-off-by: Andrey Grodzovsky <Andrey.Grodzovsky@amd.com>
Reviewed-by: Tony Cheng <Tony.Cheng@amd.com>
Acked-by: Harry Wentland <Harry.Wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
---
 drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_types.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_types.c b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_types.c
index 6054c2f..a64ebf3 100644
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_types.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_types.c
@@ -1012,8 +1012,7 @@ static int amdgpu_atomic_helper_page_flip(struct drm_crtc *crtc,
 	/* Driver takes ownership of state on successful async commit. */
 	return 0;
 fail:
-	if (ret)
-		drm_crtc_vblank_put(crtc);
+	drm_atomic_state_put(state);
 
 	return ret;
 }
-- 
2.7.4

